<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>창고 물품 재고 관리시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#f59e0b',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-purple-400 via-blue-500 to-blue-600 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white/10 backdrop-blur-lg border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <span class="text-2xl">📦</span>
                        <h1 class="ml-2 text-xl font-bold text-white">창고 물품 재고 관리시스템</h1>
                    </div>
                    <div class="hidden md:flex items-center space-x-1">
                        <span class="px-2 py-1 bg-white/20 text-white text-xs rounded-full">🔔</span>
                        <span id="username" class="text-white font-medium">admin</span>
                        <span class="text-white/60">부서명</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-white/80 text-sm">마지막 확인: 2025. 8. 2. 오후 11:18:51</span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">로그아웃</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <!-- Dashboard Header -->
        <div class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <!-- Stats Cards -->
                <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-white/80 text-sm">총 재고량 (ea)</p>
                            <p class="text-3xl font-bold mt-1">709,060</p>
                        </div>
                        <div class="bg-green-500/30 p-2 rounded-lg">
                            <span class="text-2xl">📊</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-white/80 text-sm">재고 부족 물품 수</p>
                            <p class="text-3xl font-bold mt-1">147</p>
                        </div>
                        <div class="bg-yellow-500/30 p-2 rounded-lg">
                            <span class="text-2xl">⚠️</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-white/80 text-sm">부족 물품 (콜라아식아 상세보기)</p>
                            <p class="text-3xl font-bold mt-1 text-red-400">0 ⚠️</p>
                        </div>
                        <div class="bg-red-500/30 p-2 rounded-lg">
                            <span class="text-2xl">🚨</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-6 text-white">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-white/80 text-sm">창고 구역</p>
                            <p class="text-3xl font-bold mt-1">144</p>
                        </div>
                        <div class="bg-blue-500/30 p-2 rounded-lg">
                            <span class="text-2xl">🏪</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Navigation Buttons -->
        <div class="mb-8">
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4">
                <button onclick="openTab('inventory')" class="bg-cyan-500 hover:bg-cyan-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">🗂️</div>
                    <div class="text-sm font-medium">실시간으로 처재 확인</div>
                </button>
                
                <button onclick="openTab('transactions')" class="bg-amber-500 hover:bg-amber-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">📋</div>
                    <div class="text-sm font-medium">재고관리</div>
                </button>
                
                <button onclick="openTab('inbound')" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">📥</div>
                    <div class="text-sm font-medium">입고관리</div>
                </button>
                
                <button onclick="openTab('outbound')" class="bg-red-500 hover:bg-red-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">📤</div>
                    <div class="text-sm font-medium">출고관리</div>
                </button>
                
                <button onclick="openTab('bom')" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">📄</div>
                    <div class="text-sm font-medium">이동관리</div>
                </button>
                
                <button onclick="openTab('warehouse')" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">📦</div>
                    <div class="text-sm font-medium">창고관리</div>
                </button>
                
                <button onclick="openTab('adjustment')" class="bg-pink-500 hover:bg-pink-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">🔧</div>
                    <div class="text-sm font-medium">창고 구조 관리</div>
                </button>
                
                <button onclick="openTab('reports')" class="bg-indigo-500 hover:bg-indigo-600 text-white p-4 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <div class="text-2xl mb-2">📊</div>
                    <div class="text-sm font-medium">예외관리</div>
                </button>
            </div>
        </div>

        <!-- Secondary Navigation -->
        <div class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="openTab('workdiary')" class="bg-white/20 backdrop-blur-lg hover:bg-white/30 text-white p-4 rounded-xl transition-all">
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-xl">📝</span>
                        <span class="font-medium">업무일지</span>
                    </div>
                </button>
                
                <button onclick="openTab('users')" class="bg-white/20 backdrop-blur-lg hover:bg-white/30 text-white p-4 rounded-xl transition-all">
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-xl">👥</span>
                        <span class="font-medium">사용자 관리</span>
                    </div>
                </button>
                
                <button onclick="openTab('files')" class="bg-white/20 backdrop-blur-lg hover:bg-white/30 text-white p-4 rounded-xl transition-all">
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-xl">📁</span>
                        <span class="font-medium">파일 관리</span>
                    </div>
                </button>
            </div>
        </div>

        <!-- Smart Settings Panel -->
        <div class="bg-white/20 backdrop-blur-lg rounded-2xl p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <span class="text-2xl mr-2">⚙️</span>
                    실시가이드볼 자재 확인
                </h3>
                <button class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition-colors">
                    <span class="text-lg">⚙️</span>
                </button>
            </div>
            
            <div class="mb-4">
                <h4 class="text-white/90 font-medium mb-2">실시가이드 설명</h4>
                <select class="w-full bg-white/10 border border-white/20 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-white/30">
                    <option value="">실시가이드를 선택하거나 검색하세요...</option>
                </select>
            </div>
        </div>

        <!-- Main Content Area -->
        <div id="main-content" class="bg-white/20 backdrop-blur-lg rounded-2xl p-8">
            <div class="text-center text-white">
                <div class="text-6xl mb-4">📊</div>
                <h2 class="text-2xl font-bold mb-4">창고 물품 재고 관리시스템에 오신 것을 환영합니다</h2>
                <p class="text-white/80 mb-6">위의 버튼들을 클릭하여 시스템의 다양한 기능을 이용하실 수 있습니다.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                    <div class="bg-white/10 rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-3">📈 최신 업데이트</h3>
                        <ul class="text-sm text-white/80 space-y-2 text-left">
                            <li>• Migration 완료: GitHub + Render + Supabase</li>
                            <li>• 실시간 재고 추적 시스템 활성화</li>
                            <li>• 사용자 권한 관리 시스템 업데이트</li>
                            <li>• Excel 파일 업로드/다운로드 기능</li>
                        </ul>
                    </div>
                    
                    <div class="bg-white/10 rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-3">🔧 시스템 상태</h3>
                        <ul class="text-sm text-white/80 space-y-2 text-left">
                            <li>• 데이터베이스: <span class="text-green-400">연결됨</span></li>
                            <li>• 호스팅: <span class="text-green-400">Render (무료)</span></li>
                            <li>• 백업: <span class="text-green-400">Supabase</span></li>
                            <li>• 소스코드: <span class="text-green-400">GitHub</span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 기본 탭 기능
        function openTab(tabName) {
            const content = document.getElementById('main-content');
            
            switch(tabName) {
                case 'inventory':
                    loadInventoryTab();
                    break;
                case 'transactions':
                    loadTransactionsTab();
                    break;
                case 'workdiary':
                    loadWorkDiaryTab();
                    break;
                default:
                    content.innerHTML = `
                        <div class="text-center text-white">
                            <div class="text-6xl mb-4">🚧</div>
                            <h2 class="text-2xl font-bold mb-4">${tabName} 기능</h2>
                            <p class="text-white/80">이 기능은 곧 활성화될 예정입니다.</p>
                        </div>
                    `;
            }
        }

        function loadInventoryTab() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="text-white">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <span class="text-3xl mr-3">📦</span>
                        실시간 재고 현황
                    </h2>
                    
                    <div class="mb-6">
                        <div class="flex flex-wrap gap-4 mb-4">
                            <input type="text" placeholder="제품코드 또는 제품명 검색..." 
                                   class="bg-white/10 border border-white/20 text-white placeholder-white/60 rounded-lg px-4 py-2 flex-1 min-w-64">
                            <select class="bg-white/10 border border-white/20 text-white rounded-lg px-4 py-2">
                                <option value="">전체 카테고리</option>
                                <option value="전자부품">전자부품</option>
                                <option value="기계부품">기계부품</option>
                            </select>
                            <button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-lg transition-colors">검색</button>
                        </div>
                    </div>

                    <div class="bg-white/10 rounded-xl overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-white/20">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">제품코드</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">제품명</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">카테고리</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">재고</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">위치</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-white/80 uppercase tracking-wider">상태</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-white/10" id="inventory-table-body">
                                    <tr>
                                        <td colspan="6" class="px-6 py-4 text-center text-white/60">
                                            <div class="flex items-center justify-center">
                                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-3"></div>
                                                재고 데이터를 불러오는 중...
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            // 재고 데이터 로드
            loadInventoryData();
        }

        function loadTransactionsTab() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="text-white">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <span class="text-3xl mr-3">📋</span>
                        재고 이동 내역
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <button class="bg-green-500 hover:bg-green-600 p-4 rounded-xl transition-colors">
                            <div class="text-2xl mb-2">📥</div>
                            <div class="font-medium">입고 등록</div>
                        </button>
                        <button class="bg-red-500 hover:bg-red-600 p-4 rounded-xl transition-colors">
                            <div class="text-2xl mb-2">📤</div>
                            <div class="font-medium">출고 등록</div>
                        </button>
                        <button class="bg-blue-500 hover:bg-blue-600 p-4 rounded-xl transition-colors">
                            <div class="text-2xl mb-2">🔄</div>
                            <div class="font-medium">이동 등록</div>
                        </button>
                        <button class="bg-yellow-500 hover:bg-yellow-600 p-4 rounded-xl transition-colors">
                            <div class="text-2xl mb-2">⚖️</div>
                            <div class="font-medium">재고 조정</div>
                        </button>
                    </div>

                    <div class="bg-white/10 rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4">최근 이동 내역</h3>
                        <div class="space-y-3" id="transaction-list">
                            <div class="flex items-center justify-center py-8">
                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-3"></div>
                                <span class="text-white/60">거래 내역을 불러오는 중...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 거래 내역 로드
            loadTransactionData();
        }

        function loadWorkDiaryTab() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="text-white">
                    <h2 class="text-2xl font-bold mb-6 flex items-center">
                        <span class="text-3xl mr-3">📝</span>
                        업무일지 관리
                    </h2>
                    
                    <div class="mb-6">
                        <button class="bg-green-500 hover:bg-green-600 px-6 py-3 rounded-xl transition-colors">
                            <span class="text-xl mr-2">➕</span>
                            새 업무일지 작성
                        </button>
                    </div>

                    <div class="bg-white/10 rounded-xl p-6">
                        <h3 class="text-lg font-semibold mb-4">최근 업무일지</h3>
                        <div class="space-y-4" id="workdiary-list">
                            <div class="flex items-center justify-center py-8">
                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-3"></div>
                                <span class="text-white/60">업무일지를 불러오는 중...</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 업무일지 데이터 로드
            loadWorkDiaryData();
        }

        // API 호출 함수들
        async function loadInventoryData() {
            try {
                const response = await fetch('/api/inventory');
                const data = await response.json();
                
                const tableBody = document.getElementById('inventory-table-body');
                if (data.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-6 py-4 text-center text-white/60">
                                재고 데이터가 없습니다.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tableBody.innerHTML = data.map(item => `
                    <tr class="hover:bg-white/5">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-mono">${item.code}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${item.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${item.category}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="${item.stock < item.minStock ? 'text-red-400' : 'text-green-400'} font-bold">
                                ${item.stock} ${item.unit}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">${item.location || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            ${item.stock < item.minStock ? 
                                '<span class="bg-red-500/30 text-red-200 px-2 py-1 rounded text-xs">부족</span>' : 
                                '<span class="bg-green-500/30 text-green-200 px-2 py-1 rounded text-xs">정상</span>'
                            }
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('재고 데이터 로드 실패:', error);
                const tableBody = document.getElementById('inventory-table-body');
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-red-400">
                            데이터를 불러오는 중 오류가 발생했습니다.
                        </td>
                    </tr>
                `;
            }
        }

        async function loadTransactionData() {
            try {
                const response = await fetch('/api/transactions');
                const data = await response.json();
                
                const listElement = document.getElementById('transaction-list');
                if (data.length === 0) {
                    listElement.innerHTML = `
                        <div class="text-center text-white/60 py-8">
                            거래 내역이 없습니다.
                        </div>
                    `;
                    return;
                }
                
                listElement.innerHTML = data.map(transaction => `
                    <div class="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium">${transaction.itemName} (${transaction.itemCode})</div>
                                <div class="text-sm text-white/70 mt-1">
                                    ${transaction.type === 'inbound' ? '📥 입고' : 
                                      transaction.type === 'outbound' ? '📤 출고' : 
                                      transaction.type === 'move' ? '🔄 이동' : '⚖️ 조정'} 
                                    | 수량: ${transaction.quantity}
                                </div>
                                ${transaction.reason ? 
                                    `<div class="text-xs text-white/50 mt-1">${transaction.reason}</div>` : ''
                                }
                            </div>
                            <div class="text-right text-sm text-white/60">
                                ${new Date(transaction.createdAt).toLocaleDateString('ko-KR')}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('거래 내역 로드 실패:', error);
                const listElement = document.getElementById('transaction-list');
                listElement.innerHTML = `
                    <div class="text-center text-red-400 py-8">
                        데이터를 불러오는 중 오류가 발생했습니다.
                    </div>
                `;
            }
        }

        async function loadWorkDiaryData() {
            try {
                const response = await fetch('/api/work-diary');
                const data = await response.json();
                
                const listElement = document.getElementById('workdiary-list');
                if (data.length === 0) {
                    listElement.innerHTML = `
                        <div class="text-center text-white/60 py-8">
                            업무일지가 없습니다.
                        </div>
                    `;
                    return;
                }
                
                listElement.innerHTML = data.map(diary => `
                    <div class="bg-white/5 rounded-lg p-4 hover:bg-white/10 transition-colors">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="font-medium">${diary.title}</div>
                                <div class="text-sm text-white/70 mt-1">
                                    <span class="bg-blue-500/30 text-blue-200 px-2 py-1 rounded text-xs mr-2">${diary.category}</span>
                                    <span class="bg-${diary.priority === 'high' ? 'red' : diary.priority === 'normal' ? 'green' : 'yellow'}-500/30 text-${diary.priority === 'high' ? 'red' : diary.priority === 'normal' ? 'green' : 'yellow'}-200 px-2 py-1 rounded text-xs">
                                        ${diary.priority === 'high' ? '높음' : diary.priority === 'normal' ? '보통' : '낮음'}
                                    </span>
                                </div>
                                <div class="text-sm text-white/60 mt-2 line-clamp-2">${diary.content}</div>
                            </div>
                            <div class="text-right text-sm text-white/60 ml-4">
                                ${new Date(diary.workDate).toLocaleDateString('ko-KR')}
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('업무일지 로드 실패:', error);
                const listElement = document.getElementById('workdiary-list');
                listElement.innerHTML = `
                    <div class="text-center text-red-400 py-8">
                        데이터를 불러오는 중 오류가 발생했습니다.
                    </div>
                `;
            }
        }

        // 로그아웃 함수
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST' });
                window.location.href = '/';
            } catch (error) {
                console.error('로그아웃 오류:', error);
                window.location.href = '/';
            }
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            // 기본 재고 탭 로드
            loadInventoryTab();
        });
    </script>
</body>
</html>
