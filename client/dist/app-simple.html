<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì°½ê³  ë¬¼í’ˆ ì¬ê³  ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" crossorigin href="/assets/index-DXaLrMJa.css">
    <style>
      body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
      .login-container { max-width: 400px; margin: 100px auto; }
      .login-form { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
      .form-group { margin-bottom: 20px; }
      label { display: block; margin-bottom: 5px; font-weight: bold; }
      input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
      button { width: 100%; padding: 12px; background: #7c3aed; color: white; border: none; border-radius: 4px; cursor: pointer; }
      button:hover { background: #6d28d9; }
      .error { color: red; margin-top: 10px; }
      .dashboard { padding: 20px; }
      .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; margin: -20px -20px 20px -20px; }
      .tabs { display: flex; gap: 10px; margin: 20px 0; }
      .tab { padding: 10px 20px; background: #f3f4f6; border: none; border-radius: 4px; cursor: pointer; }
      .tab.active { background: #7c3aed; color: white; }
      .content { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="login-container">
        <div class="login-form">
          <h2>ì°½ê³  ë¬¼í’ˆ ì¬ê³  ê´€ë¦¬ì‹œìŠ¤í…œ</h2>
          <form id="loginForm">
            <div class="form-group">
              <label for="username">ì‚¬ìš©ìëª…</label>
              <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
              <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
              <input type="password" id="password" name="password" required>
            </div>
            <button type="submit">ë¡œê·¸ì¸</button>
            <div id="error" class="error" style="display: none;"></div>
          </form>
        </div>
      </div>
    </div>

    <script>
      let currentUser = null;
      let sessionId = null;

      // Check if already logged in (skip session validation)
      const savedUser = localStorage.getItem('warehouse_user');
      const savedSession = localStorage.getItem('warehouse_session');
      
      if (savedUser && savedSession) {
        try {
          currentUser = JSON.parse(savedUser);
          sessionId = savedSession;
          console.log('Restoring saved session for user:', currentUser.username);
          showDashboard();
          return; // Skip showing login form
        } catch (e) {
          console.log('Failed to restore session, clearing localStorage');
          localStorage.clear();
        }
      } else {
        console.log('No saved session found, showing login form');
      }

      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorDiv = document.getElementById('error');
        
        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
          });
          
          if (!response.ok) {
            const error = await response.json();
            throw new Error(error.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
          }
          
          const data = await response.json();
          currentUser = data.user;
          sessionId = data.sessionId;
          
          localStorage.setItem('warehouse_user', JSON.stringify(data.user));
          localStorage.setItem('warehouse_session', data.sessionId);
          
          console.log('Login successful, showing dashboard for:', data.user.username);
          showDashboard();
        } catch (error) {
          errorDiv.textContent = error.message;
          errorDiv.style.display = 'block';
        }
      });

      function showDashboard() {
        document.getElementById('root').innerHTML = `
          <div class="dashboard">
            <div class="header">
              <h1>ì°½ê³  ë¬¼í’ˆ ì¬ê³  ê´€ë¦¬ì‹œìŠ¤í…œ</h1>
              <p>ì‚¬ìš©ì: ${currentUser.username} (${currentUser.role === 'super_admin' ? 'ê´€ë¦¬ì' : 'ì‚¬ìš©ì'})</p>
              <button onclick="logout()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 16px; border-radius: 4px; cursor: pointer;">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            
            <div class="tabs">
              <button class="tab active" onclick="switchTab('bom')">âš™ï¸ BOM ì²´ì»¤</button>
              <button class="tab" onclick="switchTab('inventory')">ğŸ“¦ ì¬ê³ ê´€ë¦¬</button>
              <button class="tab" onclick="switchTab('transactions')">ğŸ“¥ğŸ“¤ ì…ì¶œê³ ê´€ë¦¬</button>
              <button class="tab" onclick="switchTab('reports')">ğŸ“Š ë³´ê³ ì„œ</button>
            </div>
            
            <div class="content" id="content">
              <h3>BOM ì²´ì»¤</h3>
              <p>ì„¤ì¹˜ê°€ì´ë“œë³„ ìì¬ í™•ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.</p>
              <div style="margin-top: 20px; padding: 15px; background: #e0f2fe; border-radius: 6px;">
                <strong>âœ… ë¡œê·¸ì¸ ì„±ê³µ:</strong> ì°½ê³ ê´€ë¦¬ì‹œìŠ¤í…œì— ì ‘ì†ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                <small>í˜„ì¬ ì„ì‹œ ëŒ€ì‹œë³´ë“œê°€ í‘œì‹œë©ë‹ˆë‹¤. ê° íƒ­ì„ í´ë¦­í•˜ì—¬ ê¸°ëŠ¥ì„ í™•ì¸í•˜ì„¸ìš”.</small>
              </div>
              <div style="margin-top: 15px; padding: 15px; background: #f3f4f6; border-radius: 6px;">
                <strong>ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥:</strong><br>
                â€¢ BOM ì²´ì»¤: ì„¤ì¹˜ê°€ì´ë“œë³„ ìì¬ í™•ì¸<br>
                â€¢ ì¬ê³ ê´€ë¦¬: ì œí’ˆ ì¬ê³  í˜„í™© ì¡°íšŒ<br>
                â€¢ ì…ì¶œê³ ê´€ë¦¬: ì œí’ˆ ì…ê³ /ì¶œê³  ì²˜ë¦¬<br>
                â€¢ ë³´ê³ ì„œ: ì¬ê³  ë¶„ì„ ë° í˜„í™© ë³´ê³ ì„œ
              </div>
            </div>
          </div>
        `;
      }

      function switchTab(tab) {
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        
        const content = document.getElementById('content');
        switch(tab) {
          case 'bom':
            content.innerHTML = `
              <h3>âš™ï¸ BOM ì²´ì»¤</h3>
              <p>ì„¤ì¹˜ê°€ì´ë“œë³„ ìì¬ í™•ì¸ ê¸°ëŠ¥</p>
              <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px;">
                <h4>ì£¼ìš” ê¸°ëŠ¥</h4>
                <ul>
                  <li>ì„¤ì¹˜ê°€ì´ë“œë³„ í•„ìš” ë¶€í’ˆ ìˆ˜ëŸ‰ í™•ì¸</li>
                  <li>ì¬ê³  í˜„í™©ê³¼ ëŒ€ë¹„í•œ ë¶€ì¡± ìˆ˜ëŸ‰ ê³„ì‚°</li>
                  <li>Excel íŒŒì¼ ì—…ë¡œë“œ ë° ë¶„ì„</li>
                </ul>
              </div>
            `;
            break;
          case 'inventory':
            content.innerHTML = `
              <h3>ğŸ“¦ ì¬ê³ ê´€ë¦¬</h3>
              <p>ì œí’ˆ ì¬ê³  í˜„í™© ë° ê´€ë¦¬</p>
              <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px;">
                <h4>ì£¼ìš” ê¸°ëŠ¥</h4>
                <ul>
                  <li>ì „ì²´ ì œí’ˆ ì¬ê³  í˜„í™© ì¡°íšŒ</li>
                  <li>ì¬ê³  ë¶€ì¡± ì•Œë¦¼ ë° ê²½ê³ </li>
                  <li>ì œí’ˆë³„ ìœ„ì¹˜ ë° ìˆ˜ëŸ‰ ê´€ë¦¬</li>
                </ul>
              </div>
            `;
            break;
          case 'transactions':
            content.innerHTML = `
              <h3>ğŸ“¥ğŸ“¤ ì…ì¶œê³ ê´€ë¦¬</h3>
              <p>ì œí’ˆ ì…ê³ /ì¶œê³  ì²˜ë¦¬</p>
              <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px;">
                <h4>ì£¼ìš” ê¸°ëŠ¥</h4>
                <ul>
                  <li>ì œí’ˆ ì…ê³  ë“±ë¡ ë° ì²˜ë¦¬</li>
                  <li>ì œí’ˆ ì¶œê³  ì²˜ë¦¬ ë° ì¬ê³  ì°¨ê°</li>
                  <li>ì…ì¶œê³  ì´ë ¥ ì¡°íšŒ ë° ê´€ë¦¬</li>
                </ul>
              </div>
            `;
            break;
          case 'reports':
            content.innerHTML = `
              <h3>ğŸ“Š ë³´ê³ ì„œ</h3>
              <p>ì¬ê³  í˜„í™© ë° ë¶„ì„ ë³´ê³ ì„œ</p>
              <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px;">
                <h4>ì£¼ìš” ê¸°ëŠ¥</h4>
                <ul>
                  <li>ì¼ì¼/ì£¼ê°„/ì›”ê°„ ì¬ê³  í˜„í™© ë³´ê³ ì„œ</li>
                  <li>ì…ì¶œê³  í†µê³„ ë° ë¶„ì„</li>
                  <li>Excel ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ</li>
                </ul>
              </div>
            `;
            break;
        }
      }

      function logout() {
        localStorage.clear();
        currentUser = null;
        sessionId = null;
        location.reload();
      }
    </script>
  </body>
</html>